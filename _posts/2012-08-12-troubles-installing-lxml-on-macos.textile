---
layout: post
title: Troubles installing lxml on MacOS
---

h1. {{ page.title }}

Rumours are that you can't replace the default versions of libxml2 and libxslt that comes with MacOS (I'm talking about MacOS 10.5 here), otherwise all kinds of evil will come to you.

Problem is that lxml requires newer versions of both libxslt and libxml2.

Solution, as given on lots of websites out there, is to simply build lxml and the newer versions of libxslt and libxml2 altogether and then use a strategy of static linking the libraries, so that lxml can run without depending on the system versions. It goes like this:

{% highlight bash %}
$ STATIC_DEDS=true pip install lxml
{% endhighlight %}

So far so good, but when I try to do this, it ends with the following error:

{% highlight bash %}
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I.. -I.. -I../libxslt -I/Users/chromano/lxml/build/lxml/build/tmp/libxml2/include/libxml2 -I/Users/chromano/lxml/build/lxml/build/tmp/libxml2/include -g -O2 -Wall -c pattern.c -o pattern.o
xsltutils.c: In function 'xsltSaveResultTo':
xsltutils.c:1541: warning: passing argument 1 of 'xmlBufferWriteQuotedString' from incompatible pointer type
xsltutils.c:1554: warning: passing argument 1 of 'xmlBufferWriteQuotedString' from incompatible pointer type
xsltutils.c: In function 'xsltSaveResultToString':
xsltutils.c:1758: error: dereferencing pointer to incomplete type
xsltutils.c:1759: error: dereferencing pointer to incomplete type
xsltutils.c:1761: error: dereferencing pointer to incomplete type
xsltutils.c:1762: error: dereferencing pointer to incomplete type
make[2]: *** [xsltutils.lo] Error 1
{% endhighlight %}

It happens because lxml downloaded and tried to build the latest version of libxslt and libxml2. However I discovered that the latest libxslt (1.1.26) doesn't compile with libxml2 2.9.0!

The solution is pretty simple though, you just have to specify the correct version of libxml2 you want to use - and for libxslt 1.1.26 it is 2.7.8 (I discovered this after asking a friend what was the version of these libraries on his ubuntu, thanks Felipe!):

{% highlight bash %}
$ LIBXML2_VERSION=2.7.8 STATIC_DEPS=true pip install lxml
{% endhighlight %}

You're welcome!
